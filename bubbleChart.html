<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html" charset="utf-8">

    <title>Bubble Chart</title>
    <link rel="stylesheet" href="static/css/style.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/dc.css"/>

    <script type="text/javascript" src="static/js/d3.js"></script>
    <script type="text/javascript" src="static/js/crossfilter.js"></script>
    <script type="text/javascript" src="static/js/dc.js"></script>
</head>
<body>

<header>
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <img src="resources/dclogo.png">
            </div>
            <div class="col-md-10">
                <h1 class="logo">DC.js Examples</h1>
                <h4>Richard Dalton</h4>
                <div class="btn-group btn-group-md" role="group" aria-label="...">
                    <a href="index.html" class="btn btn-default" role="button">Home</a>
                    <a href="average.html" class="btn btn-default" role="button">Average</a>
                    <a href="dynamicdimension.html" class="btn btn-default" role="button">Dynamic Dimension</a>
                    <a href="compositeChart.html" class="btn btn-default" role="button">Composite</a>
                    <a href="stacked.html" class="btn btn-default" role="button">Stacked</a>
                    <a href="bubbleChart.html" class="btn btn-default" role="button">Bubble</a>
                    <a href="https://dc-js.github.io/dc.js/" class="btn btn-default" role="button">DC.js</a>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="container">
    <h3>Bubble Chart</h3>
    <p>A bubble chart allows plotting more dimensions and measures than a bar, line or pie chart.</p>
    <p>As with the bar and line charts, the x and y axes can be used. The radius and even the colour of the bubbles can also represent measures.</p>

    <div id="amount-price-country-chart"></div>
</div>




<script type="text/javascript">
    var numberFormat = d3.format(".2f");

    function print_filter(filter) {
        var f = eval(filter);
        if (typeof (f.length) != "undefined") {} else {}
        if (typeof (f.top) != "undefined") {f = f.top(Infinity);} else {}
        if (typeof (f.dimension) != "undefined")
        {f = f.dimension(function(d) {
            return "";}).top(Infinity);
        }
        else
        {}

        console.log(
            filter + "(" + f.length + ") = " +
            JSON.stringify(f)
                .replace("[","[\n\t")
                .replace("]","\n]")
        );
    }

    var data =
        [
            {date: "19000103", country: "Ireland",  amount: 10000,  price:  50},
            {date: "19000103", country: "Australia", amount: 20000, price:  60},
            {date: "19000103", country: "Austria",  amount: 15000,  price:  40},
            {date: "19000103", country: "France",   amount: 12500,  price:  100},
            {date: "19000103", country: "Germany",  amount: 22000,  price:  120},
            {date: "19000103", country: "Japan",    amount: 30000,  price:  150},
            {date: "19000103", country: "USA",      amount: 50000,  price:  200},
            {date: "19000103", country: "Belgium",  amount: 1000,   price:  50},
            {date: "19000103", country: "Italy",    amount: 32000,  price:  60},
            {date: "19000103", country: "Spain",    amount: 18000,  price:  75},
            {date: "19000103", country: "Malta",    amount: 19000,  price:  80},
            {date: "19000103", country: "China",    amount: 12000,  price:  90},
            {date: "19000103", country: "Mexico",   amount: 11000,  price:  150},
            {date: "19000103", country: "Yemen",    amount: 500,    price:  5},
            {date: "19000103", country: "Norway",   amount: 27500,  price:  150},
            {date: "19000103", country: "Sweden",   amount: 3400,   price:  55},
            {date: "19000103", country: "Denmark",  amount: 5600,   price:  65},
            {date: "19000103", country: "Finland",  amount: 19700,  price:  90},
            {date: "19000103", country: "Scotland", amount: 21000,  price:  45},
            {date: "19000103", country: "England",  amount: 1300,   price:  35}
        ];

    var ndx = crossfilter(data);

    var parseDate = d3.time.format("%Y%m%d").parse;

    data.forEach(function(d){
        d.date = parseDate(d.date);
    });

    var countryDim = ndx.dimension(function(d){
        return d.country;
    });

    var statsByCountry = countryDim.group().reduce(
        function (p, v) {
            p.amount += +v["amount"];
            p.price += +v["price"];
            return p;
        },
        function (p, v) {
            p.amount -= +v["amount"];
            p.price -= +v["price"];
            return p;
        },
        function () {
            return {amount: 0, price: 0}
        }
    );


    var amount_price_country_chart = dc.bubbleChart("#amount-price-country-chart");

    amount_price_country_chart.width(990)
        .height(400)
        .margins({top: 10, right: 50, bottom: 30, left: 60})
        .dimension(countryDim)
        .group(statsByCountry)
        .colors(d3.scale.category20())
        .keyAccessor(function (p) {
            return p.value.amount;
        })
        .valueAccessor(function (p) {
            return p.value.price;
        })
        .radiusValueAccessor(function (p) {
            return p.value.amount;
        })
        .x(d3.scale.linear().domain([0, 70000]))
        .r(d3.scale.linear().domain([0, 70000]))
        .minRadiusWithLabel(15)
        .elasticY(true)
        .yAxisPadding(100)
        .elasticX(true)
        .xAxisPadding(10000)
        .maxBubbleRelativeSize(0.07)
        .renderHorizontalGridLines(true)
        .renderVerticalGridLines(true)
        .renderLabel(true)
        .renderTitle(true)
        .title(function (p) {
            return p.key
                + "\n"
                + "Amount : " + numberFormat(p.value.amount) + "\n"
                + "Price: " + numberFormat(p.value.price);
        });
    amount_price_country_chart.yAxis().tickFormat(function (s) {
        return s;
    });
    amount_price_country_chart.xAxis().tickFormat(function (s) {
        return s;
    });


    dc.renderAll();

</script>

</body>
</html>